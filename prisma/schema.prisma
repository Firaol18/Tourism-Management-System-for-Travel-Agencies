generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id           Int      @id @default(autoincrement())
  username     String   @unique @map("UserName") @db.VarChar(100)
  password     String   @map("Password") @db.VarChar(100)
  updationDate DateTime @default(now()) @updatedAt @map("updationDate")

  @@map("admin")
}

model User {
  id              Int            @id @default(autoincrement())
  fullName        String         @map("FullName") @db.VarChar(100)
  mobileNumber    String         @map("MobileNumber") @db.Char(10)
  emailId         String         @unique @map("EmailId") @db.VarChar(70)
  password        String         @map("Password") @db.VarChar(100)
  regDate         DateTime       @default(now()) @map("RegDate")
  updationDate    DateTime       @default(now()) @updatedAt @map("UpdationDate")
  bookings        Booking[]
  issues          Issue[]
  reviews         Review[]
  testimonials    Testimonial[]
  referrerReferrals Referral[]   @relation("Referrer")
  referredReferrals Referral[]   @relation("Referred")

  @@index([emailId])
  @@map("tblusers")
}

model TourPackage {
  id              Int       @id @default(autoincrement()) @map("PackageId")
  packageName     String    @map("PackageName") @db.VarChar(200)
  packageType     String    @map("PackageType") @db.VarChar(150)
  packageLocation String    @map("PackageLocation") @db.VarChar(100)
  packagePrice    Int       @map("PackagePrice")
  packageFeatures String    @map("PackageFetures") @db.VarChar(255)
  packageDetails  String    @map("PackageDetails")
  packageImage    String    @map("PackageImage") @db.VarChar(100)
  capacity        Int?      @default(20) @map("Capacity")
  availableSlots  Int?      @default(20) @map("AvailableSlots")
  isAvailable     Boolean   @default(true) @map("IsAvailable")
  viewCount       Int       @default(0) @map("ViewCount")
  creationDate    DateTime  @default(now()) @map("Creationdate")
  updationDate    DateTime? @updatedAt @map("UpdationDate")
  bookings        Booking[]
  reviews         Review[]

  @@index([packageType])
  @@index([packageLocation])
  @@index([packagePrice])
  @@map("tbltourpackages")
}

model Booking {
  id             Int         @id @default(autoincrement()) @map("BookingId")
  packageId      Int         @map("PackageId")
  userEmail      String      @map("UserEmail") @db.VarChar(100)
  fromDate       String      @map("FromDate") @db.VarChar(100)
  toDate         String      @map("ToDate") @db.VarChar(100)
  comment        String      @map("Comment")
  numberOfPeople Int         @default(1) @map("NumberOfPeople")
  totalAmount    Decimal     @default(0) @map("TotalAmount") @db.Decimal(10, 2)
  isGroupBooking Boolean     @default(false) @map("IsGroupBooking")
  regDate        DateTime    @default(now()) @map("RegDate")
  status         Int         @default(0)
  cancelledBy    String?     @map("CancelledBy") @db.VarChar(5)
  updationDate   DateTime?   @updatedAt @map("UpdationDate")
  package        TourPackage @relation(fields: [packageId], references: [id])
  user           User        @relation(fields: [userEmail], references: [emailId])

  @@index([status])
  @@index([userEmail])
  @@map("tblbooking")
}

model Enquiry {
  id           Int      @id @default(autoincrement())
  fullName     String   @map("FullName") @db.VarChar(100)
  emailId      String   @map("EmailId") @db.VarChar(100)
  mobileNumber String   @map("MobileNumber") @db.Char(10)
  subject      String   @map("Subject") @db.VarChar(100)
  description  String   @map("Description")
  postingDate  DateTime @default(now()) @map("PostingDate")
  status       Int?     @map("Status")

  @@map("tblenquiry")
}

model Issue {
  id              Int       @id @default(autoincrement())
  userEmail       String    @map("UserEmail") @db.VarChar(100)
  issue           String    @map("Issue") @db.VarChar(100)
  description     String    @map("Description")
  postingDate     DateTime  @default(now()) @map("PostingDate")
  adminRemark     String?   @map("AdminRemark")
  adminRemarkDate DateTime? @map("AdminremarkDate")
  user            User      @relation(fields: [userEmail], references: [emailId])

  @@map("tblissues")
}

model Page {
  id     Int    @id @default(autoincrement())
  type   String @db.VarChar(255)
  detail String

  @@map("tblpages")
}

// Enhanced Features Models

model Review {
  id          Int         @id @default(autoincrement())
  packageId   Int         @map("PackageId")
  userEmail   String      @map("UserEmail") @db.VarChar(100)
  rating      Int         // 1-5 stars
  title       String      @db.VarChar(200)
  comment     String      @db.Text
  photos      String[]    // Array of image URLs
  isApproved  Boolean     @default(false) @map("IsApproved")
  createdAt   DateTime    @default(now()) @map("CreatedAt")
  updatedAt   DateTime    @updatedAt @map("UpdatedAt")
  package     TourPackage @relation(fields: [packageId], references: [id])
  user        User        @relation(fields: [userEmail], references: [emailId])

  @@index([packageId])
  @@index([isApproved])
  @@map("tblreviews")
}

model Testimonial {
  id         Int      @id @default(autoincrement())
  userEmail  String   @map("UserEmail") @db.VarChar(100)
  content    String   @db.Text
  rating     Int      // 1-5 stars
  isApproved Boolean  @default(false) @map("IsApproved")
  createdAt  DateTime @default(now()) @map("CreatedAt")
  user       User     @relation(fields: [userEmail], references: [emailId])

  @@index([isApproved])
  @@map("tbltestimonials")
}

model BlogPost {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(200)
  slug        String   @unique @db.VarChar(250)
  content     String   @db.Text
  excerpt     String   @db.VarChar(500)
  coverImage  String   @db.VarChar(255)
  authorId    Int      @map("AuthorId")
  category    String?  @db.VarChar(100)
  tags        String[] // Array of tags
  isPublished Boolean  @default(false) @map("IsPublished")
  viewCount   Int      @default(0) @map("ViewCount")
  createdAt   DateTime @default(now()) @map("CreatedAt")
  updatedAt   DateTime @updatedAt @map("UpdatedAt")

  @@index([slug])
  @@index([isPublished])
  @@index([category])
  @@map("tblblogposts")
}

model Newsletter {
  id           Int      @id @default(autoincrement())
  email        String   @unique @db.VarChar(100)
  isActive     Boolean  @default(true) @map("IsActive")
  subscribedAt DateTime @default(now()) @map("SubscribedAt")

  @@index([email])
  @@map("tblnewsletter")
}

model Referral {
  id            Int       @id @default(autoincrement())
  referrerEmail String    @map("ReferrerEmail") @db.VarChar(100)
  referredEmail String    @map("ReferredEmail") @db.VarChar(100)
  status        String    @default("pending") @db.VarChar(20) // pending, completed
  reward        Decimal   @default(0) @map("Reward") @db.Decimal(10, 2)
  createdAt     DateTime  @default(now()) @map("CreatedAt")
  completedAt   DateTime? @map("CompletedAt")
  referrer      User      @relation("Referrer", fields: [referrerEmail], references: [emailId])
  referred      User      @relation("Referred", fields: [referredEmail], references: [emailId])

  @@index([referrerEmail])
  @@index([status])
  @@map("tblreferrals")
}
